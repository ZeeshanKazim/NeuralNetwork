<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Retention Radar – Churn Risk Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="style.css" />

  <!-- Client-side libraries (no backend required) -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.5.3/papaparse.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <span class="logo-dot"></span>
      <div class="brand-text">
        <span class="brand-title">AI Retention Radar</span>
        <span class="brand-subtitle">E-commerce churn &amp; revenue risk</span>
      </div>
    </div>
    <div class="top-status">
      <span id="app-status">Initializing…</span>
    </div>
  </header>

  <main class="layout">
    <!-- 1. Overview & controls -->
    <section class="panel">
      <h2>1. Customer overview &amp; controls</h2>
      <p class="muted">
        This dashboard loads the embedded churn dataset automatically. No uploads required –
        just explore risk segments, customer lists, and campaign exports.
      </p>

      <!-- KPI overview -->
      <div class="summary-grid">
        <div class="summary-card">
          <div class="summary-label">Total customers</div>
          <div class="summary-value" id="overview-total">–</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">Churn rate</div>
          <div class="summary-value" id="overview-churn">–</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">High-risk customers</div>
          <div class="summary-value" id="overview-high">–</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">Revenue at risk*</div>
          <div class="summary-value" id="overview-revenue">–</div>
        </div>
      </div>
      <p class="muted" style="font-size:0.75rem;margin-top:-2px;">
        *Approximate – based on cashback amounts for high-risk customers.
      </p>

      <h3>Dataset summary (internal)</h3>
      <div class="summary-grid">
        <div class="summary-card">
          <div class="summary-label">Rows</div>
          <div class="summary-value" id="summary-rows">–</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">Columns</div>
          <div class="summary-value" id="summary-cols">–</div>
        </div>
        <div class="summary-card">
          <div class="summary-label">Missing values</div>
          <div class="summary-value" id="summary-missing">–</div>
        </div>
      </div>

      <h3>Activity log</h3>
      <div id="log-console" class="log-console"></div>

      <!-- Advanced options kept for data/AI team; customers can ignore -->
      <details style="margin-top:8px;">
        <summary>Advanced: data &amp; model options (optional)</summary>
        <p class="muted" style="margin-top:6px;">
          These controls are for the data / AI team. The dashboard already auto-loads the
          sample dataset and trains the model in the browser.
        </p>

        <div class="controls-grid" style="margin-top:4px;">
          <button id="btn-load-data" class="btn small">
            Reload sample data
          </button>
          <button id="btn-preprocess" class="btn small">
            Re-run preprocessing
          </button>
          <button id="btn-reset" class="btn ghost small">
            Hard reset
          </button>
        </div>

        <div class="field-group" style="margin-top:8px;">
          <div class="field">
            <label for="file-train">Optional: custom train CSV</label>
            <input type="file" id="file-train" accept=".csv" />
            <small id="train-summary" class="muted">
              Using built-in train_web.csv (5630 rows) by default.
            </small>
          </div>

          <div class="field">
            <label for="file-score">Optional: custom scoring CSV</label>
            <input type="file" id="file-score" accept=".csv" />
            <small id="score-summary" class="muted">
              Using built-in scoring_web.csv (5630 rows) by default.
            </small>
          </div>
        </div>
      </details>
    </section>

    <!-- 2. Model & metrics -->
    <section class="panel">
      <h2>2. Model performance</h2>
      <p class="muted">
        A shallow neural network is trained directly in your browser with TensorFlow.js.
        Use this view to understand how well we separate churners from retained customers.
      </p>

      <div class="controls-grid">
        <button id="btn-train" class="btn">
          Re-train model in browser
        </button>
        <button id="btn-evaluate" class="btn">
          Recompute metrics &amp; ROC
        </button>
      </div>

      <div class="threshold-container">
        <label for="threshold-slider">
          Decision threshold:
          <span id="threshold-display">0.50</span>
        </label>
        <input
          type="range"
          id="threshold-slider"
          min="0"
          max="1"
          step="0.01"
          value="0.5"
        />
      </div>

      <h3>Metrics</h3>
      <div class="metrics-grid">
        <div class="metric-card">
          <span class="metric-label">AUC</span>
          <span class="metric-value" id="metric-auc">–</span>
        </div>
        <div class="metric-card">
          <span class="metric-label">Accuracy</span>
          <span class="metric-value" id="metric-accuracy">–</span>
        </div>
        <div class="metric-card">
          <span class="metric-label">Precision</span>
          <span class="metric-value" id="metric-precision">–</span>
        </div>
        <div class="metric-card">
          <span class="metric-label">Recall</span>
          <span class="metric-value" id="metric-recall">–</span>
        </div>
        <div class="metric-card">
          <span class="metric-label">F1</span>
          <span class="metric-value" id="metric-f1">–</span>
        </div>
      </div>

      <h3>Confusion matrix</h3>
      <table class="confusion-table">
        <thead>
          <tr>
            <th></th>
            <th>Pred 0</th>
            <th>Pred 1</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <th>True 0</th>
            <td id="cm-tn">–</td>
            <td id="cm-fp">–</td>
          </tr>
          <tr>
            <th>True 1</th>
            <td id="cm-fn">–</td>
            <td id="cm-tp">–</td>
          </tr>
        </tbody>
      </table>

      <h3>ROC curve</h3>
      <div class="chart-wrapper">
        <canvas id="rocChart"></canvas>
      </div>
    </section>

    <!-- 3. Customer list & exports -->
    <section class="panel">
      <h2>3. Customer list &amp; exports</h2>
      <p class="muted">
        Browse customers ranked by churn risk, filter by risk segment, and export lists
        for retention campaigns.
      </p>

      <div class="controls-grid">
        <button id="btn-score" class="btn primary">
          Re-score customers
        </button>
      </div>

      <div class="controls-grid exports">
        <button id="btn-export-model" class="btn ghost small">
          Export model (TF.js)
        </button>
        <button id="btn-export-metrics-json" class="btn ghost small">
          Export metrics (JSON)
        </button>
        <button id="btn-export-metrics-csv" class="btn ghost small">
          Export metrics (CSV)
        </button>
        <button id="btn-export-scores" class="btn ghost small">
          Export scores (CSV)
        </button>
      </div>

      <h3>Filter &amp; search customers</h3>
      <div class="field-group">
        <div class="field">
          <label for="filter-risk">Risk segment</label>
          <select id="filter-risk">
            <option value="all">All segments</option>
            <option value="high">High risk (≥ 0.70)</option>
            <option value="medium">Medium risk (0.40 – 0.69)</option>
            <option value="low">Low risk (&lt; 0.40)</option>
          </select>
        </div>
        <div class="field">
          <label for="search-id">Search by Customer ID</label>
          <input type="text" id="search-id" placeholder="e.g. 52839" />
        </div>
      </div>

      <h3>Scored customers</h3>
      <div class="table-wrapper">
        <table id="score-table">
          <thead>
            <tr>
              <th>Customer ID</th>
              <th>Churn probability</th>
              <th>Prediction</th>
              <th>Recency</th>
              <th>Frequency</th>
              <th>Monetary</th>
            </tr>
          </thead>
          <tbody>
            <!-- filled by app.js -->
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <footer class="footer">
    <span>
      Deployed on GitHub Pages · All data &amp; inference run client-side in your browser.
    </span>
  </footer>

  <script src="app.js"></script>
</body>
</html>
