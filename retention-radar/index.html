<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>AI Retention Radar — E-commerce Churn Scoring</title>

  <!-- Force relative resolution inside the current folder -->
  <base href="./">

  <!-- libs -->
  <script defer src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.22.0/dist/tf.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    :root{--bg:#0b0f17;--panel:#12182a;--ink:#e9edf6;--muted:#a7b0c3;--accent:#7ee787;--warn:#ff9aa2;}
    *{box-sizing:border-box;margin:0;padding:0}
    body{background:linear-gradient(180deg,#0a0f1a,#0f1424);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,sans-serif;padding:26px}
    .wrap{max-width:1100px;margin:0 auto}
    h1{font-size:clamp(1.5rem,2.6vw,2.1rem);margin-bottom:6px}
    .muted{color:var(--muted)}
    .badges{position:fixed;right:16px;top:16px;display:flex;gap:8px;z-index:5}
    .badge{padding:6px 10px;border-radius:999px;font-size:.85rem;background:#1a2239;border:1px solid rgba(255,255,255,.12)}
    .ok{background:rgba(126,231,135,.18);border-color:rgba(126,231,135,.35)}
    .fail{background:rgba(255,154,162,.18);border-color:rgba(255,154,162,.4)}
    .panel{margin-top:14px;padding:14px;border:1px solid rgba(255,255,255,.12);border-radius:14px;background:var(--panel)}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    button, input[type="file"]{background:#1c2440;color:var(--ink);border:1px solid rgba(255,255,255,.16);padding:9px 12px;border-radius:10px;cursor:pointer}
    .pill{padding:7px 10px;border-radius:10px;background:#1a2239;border:1px solid rgba(255,255,255,.12);font-size:.9rem}
    #preview{margin-top:10px;max-height:240px;overflow:auto;border:1px dashed rgba(255,255,255,.18);border-radius:10px;padding:8px;font-family:ui-monospace,Menlo,Consolas,monospace;font-size:.9rem;white-space:pre}
    #roc{height:340px;border-radius:10px;border:1px solid rgba(255,255,255,.12);display:flex;align-items:center;justify-content:center;color:var(--muted)}
    table.kv{width:100%;border-collapse:collapse;margin-top:10px}
    table.kv th,table.kv td{border-bottom:1px solid rgba(255,255,255,.1);padding:8px;text-align:left}
    .grid{display:grid;gap:14px}
    @media(min-width:900px){.cols-2{grid-template-columns:1fr 1fr}}
  </style>
</head>
<body>
<div class="badges">
  <span id="bModel" class="badge fail">Model: failed to load</span>
  <span id="bSpec"  class="badge fail">Spec: failed to load</span>
</div>

<div class="wrap">
  <h1>AI Retention Radar — E-commerce Churn Scoring</h1>
  <p class="muted">Load your exported TF.js model, upload a CSV, get probabilities, metrics, and downloads — client-side only.</p>

  <!-- 1) Data -->
  <div class="panel">
    <div class="row">
      <strong>1) Data Load</strong>
      <input id="csvFile" type="file" accept=".csv"/>
      <span id="shape" class="pill">Rows: — | Cols: —</span>
    </div>
    <div id="preview" class="muted">Preview</div>
  </div>

  <!-- 2) Predict -->
  <div class="panel">
    <div class="row">
      <strong>2) Preprocess & Predict</strong>
      <button id="btnRun">Run Predictions</button>
      <span id="scored"  class="pill">Scored Rows: —</span>
      <span id="hasY"    class="pill">Has Labels: —</span>
      <span id="aucTxt"  class="pill">AUC: —</span>
    </div>
  </div>

  <!-- 3) ROC -->
  <div class="panel">
    <strong>3) ROC Curve</strong>
    <div id="roc" class="muted">Upload a CSV with the label column to display ROC/AUC.</div>
  </div>

  <!-- 4) Threshold -->
  <div class="panel">
    <strong>4) Threshold, Confusion & F1</strong>
    <div class="row" style="margin-top:10px">
      <label>Threshold:
        <input id="thr" type="range" min="0" max="1" step="0.01" value="0.5"/>
      </label>
      <span id="thrVal" class="pill">0.50</span>
    </div>
    <table class="kv">
      <thead><tr><th>Metric</th><th>Value</th></tr></thead>
      <tbody id="cmBody">
        <tr><td>TN</td><td>—</td></tr>
        <tr><td>FP</td><td>—</td></tr>
        <tr><td>FN</td><td>—</td></tr>
        <tr><td>TP</td><td>—</td></tr>
        <tr><td>Precision</td><td>—</td></tr>
        <tr><td>Recall</td><td>—</td></tr>
        <tr><td>F1</td><td>—</td></tr>
      </tbody>
    </table>
    <div class="row" style="margin-top:10px">
      <span id="posClass" class="pill">Positive Class = “Churn”</span>
      <span id="defaultThr" class="pill">Default Threshold —</span>
      <span id="specTarget" class="pill">Spec Target —</span>
    </div>
  </div>

  <!-- 5) Ranking -->
  <div class="panel">
    <strong>5) Top Risk — Churn Ranking</strong>
    <div class="row" style="margin-top:10px">
      <button id="btnSub">Download submission.csv</button>
      <button id="btnProbs">Download probabilities.csv</button>
    </div>
    <div id="rank" class="muted" style="margin-top:10px">Sort by probability desc.</div>
  </div>
</div>

<script defer src="app.js"></script>
</body>
</html>
