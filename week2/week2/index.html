<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Titanic Binary Classifier — TensorFlow.js (Week 2)</title>

  <!-- Required CDNs per assignment -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>

  <style>
    :root{ --bg:#0b1220; --panel:#0e172a; --ink:#e9edf6; --muted:#a5b0c5; --card:rgba(255,255,255,.06); --border:rgba(255,255,255,.14); --ring:rgba(125,180,255,.35); }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,sans-serif; background:radial-gradient(1100px 650px at 8% -10%, #1a2b47 0%, #0b1220 60%), linear-gradient(180deg, #09111f,#0b1220); color:var(--ink); min-height:100vh; padding:24px}
    .wrap{max-width:1100px;margin:0 auto}
    h1{font-size:clamp(1.4rem,2.4vw,2rem);line-height:1.1;margin-bottom:6px}
    h2{margin-bottom:6px}
    p.muted{color:var(--muted);margin-bottom:14px}
    section{background:linear-gradient(180deg,var(--panel),#0b1326); border:1px solid var(--border); border-radius:16px; padding:16px; margin:10px 0}
    .grid{display:grid;gap:10px}
    .cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}
    @media(max-width:900px){.cols-2{grid-template-columns:1fr}}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    input[type=file],button,select{background:var(--card);color:var(--ink); border:1px solid var(--border); border-radius:10px; padding:8px 10px; cursor:pointer}
    button:focus,select:focus,input:focus{outline:none;box-shadow:0 0 0 3px var(--ring)}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{border:1px solid var(--border);padding:6px;text-align:left;font-size:.92rem}
    .hint{font-size:.9rem;color:var(--muted)}
    .kpis{display:flex;gap:10px;flex-wrap:wrap}
    .kpi{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:10px 12px}
    .kpi .big{font-weight:800;font-size:1.2rem}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace; font-size:.92rem}
    .sliderRow{display:flex;gap:10px;align-items:center;margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Titanic Binary Classifier — TensorFlow.js</h1>
      <p class="muted">Week 2: shallow neural net entirely in the browser. Upload Kaggle <code>train.csv</code> / <code>test.csv</code>, then Preprocess → Build → Train → Evaluate (ROC‑AUC) → Predict/Export. No server needed.</p>
    </header>

    <!-- Data Load -->
    <section id="sec-data">
      <h2>Data Load</h2>
      <div class="row" style="margin-top:6px">
        <label>train.csv <input id="trainFile" type="file" accept=".csv"></label>
        <label>test.csv <input id="testFile" type="file" accept=".csv"></label>
        <button id="btnLoad">Load Files</button>
        <span class="hint">Target: <b>Survived</b> (0/1). Features: <b>Pclass, Sex, Age, SibSp, Parch, Fare, Embarked</b>. Ignore: <b>PassengerId</b>.</span>
      </div>
      <div id="dataPreview" class="grid cols-2">
        <div>
          <div class="kpis" style="margin-top:8px">
            <div class="kpi">Train rows: <span id="kTrain" class="big">–</span></div>
            <div class="kpi">Test rows: <span id="kTest" class="big">–</span></div>
            <div class="kpi">Missing % (train): <span id="kMiss" class="big">–</span></div>
          </div>
          <div id="previewTable"></div>
        </div>
        <div>
          <div id="edaSex"></div>
          <div id="edaClass" style="margin-top:10px"></div>
        </div>
      </div>
    </section>

    <!-- Preprocessing -->
    <section id="sec-pre">
      <h2>Preprocessing</h2>
      <div class="row">
        <label><input id="featFamily" type="checkbox" checked> Add FamilySize = SibSp + Parch + 1</label>
        <label><input id="featAlone" type="checkbox" checked> Add IsAlone = (FamilySize == 1)</label>
        <button id="btnPre">Run Preprocessing</button>
        <span class="hint">Impute Age = median; Embarked = mode; Standardize Age/Fare; One‑hot Sex/Pclass/Embarked.</span>
      </div>
      <pre id="preInfo" class="mono" style="margin-top:8px"></pre>
    </section>

    <!-- Model -->
    <section id="sec-model">
      <h2>Model</h2>
      <div class="row">
        <button id="btnBuild">Build Model</button>
        <button id="btnSummary">Show Summary</button>
      </div>
      <pre id="modelSummary" class="mono" style="margin-top:8px"></pre>
      <p class="hint">Architecture: Dense(16, relu) → Dense(1, sigmoid). Compile: adam + binaryCrossentropy + accuracy.</p>
    </section>

    <!-- Training -->
    <section id="sec-train">
      <h2>Training</h2>
      <div class="row">
        <button id="btnTrain">Train (50 epochs, batch 32)</button>
        <button id="btnStop">Early Stop</button>
      </div>
      <p class="hint">80/20 stratified split; tfjs‑vis live charts; early stopping on val_loss (patience=5). The tfjs‑vis visor will pop up with loss/accuracy.</p>
      <div id="visLossAcc" class="mono"></div>
    </section>

    <!-- Metrics (ROC/AUC + threshold slider) -->
    <section id="sec-metrics">
      <h2>Metrics</h2>
      <div id="rocPlot"></div>
      <div class="sliderRow">
        <label>Threshold: <span id="thVal">0.50</span></label>
        <input id="thSlider" type="range" min="0" max="1" step="0.01" value="0.5" style="width:240px">
        <span class="hint">Move slider to update confusion matrix & F1.</span>
      </div>
      <div class="grid cols-2" style="margin-top:8px">
        <div id="confMat"></div>
        <div>
          <pre id="prf" class="mono"></pre>
        </div>
      </div>
    </section>

    <!-- Prediction / Export -->
    <section id="sec-pred">
      <h2>Prediction & Export</h2>
      <div class="row">
        <button id="btnPredict">Predict test.csv</button>
        <button id="btnSub">Download submission.csv</button>
        <button id="btnProb">Download probabilities.csv</button>
        <button id="btnSaveModel">Save model</button>
      </div>
      <p id="predInfo" class="hint" style="margin-top:6px"></p>
    </section>

    <!-- Deployment notes -->
    <section id="sec-notes">
      <h2>Deployment Notes</h2>
      <ol class="hint">
        <li>Create a public GitHub repo.</li>
        <li>Add <code>index.html</code> and <code>app.js</code> to the root (you can include sample CSVs for testing).</li>
        <li>Enable GitHub Pages: Settings → Pages → Deploy from branch (main/root).</li>
        <li>Open the URL and upload <code>train.csv</code>/<code>test.csv</code> via the inputs above.</li>
      </ol>
    </section>
  </div>

  <!-- Link the unified robust app.js -->
  <script defer src="app.js"></script>
</body>
</html>
